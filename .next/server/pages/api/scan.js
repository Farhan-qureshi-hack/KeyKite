"use strict";(()=>{var e={};e.id=881,e.ids=[881],e.modules={1287:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},7598:(e,t,r)=>{r.r(t),r.d(t,{config:()=>y,default:()=>m,routeModule:()=>g});var s={};r.r(s),r.d(s,{default:()=>handler});var n=r(1802),i=r(7153),a=r(6249);let c=require("os");var l=r.n(c);let u=require("path");var o=r.n(u),p=r(7147),d=r.n(p);let h=require("simple-git");var f=r(7989);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,error:"POST only"});let{repoUrl:r}=e.body;if(!r||"string"!=typeof r)return t.status(400).json({success:!1,error:"repoUrl required"});let s=o().join(l().tmpdir(),`keykite-${Date.now()}`),n=(0,h.simpleGit)(),i=[];try{let e=r,a=process.env.GITHUB_TOKEN,c=r.match(/https?:\/\/(github\.com\/.+)/i);if(a&&c){let t=c[1].replace(/^\/?/,""),s=r.endsWith(".git")?r:`https://github.com/${t}.git`,n=new URL(s);n.username=a,e=n.toString()}await n.clone(e,s,["--depth","1"]);let l=function walkDir(e,t=[]){let r=[],s=d().readdirSync(e);for(let n of s){let s=o().join(e,n);try{let e=d().statSync(s);e.isDirectory()?r.push(...walkDir(s,t)):e.isFile()&&(0===t.length||t.some(e=>s.endsWith(e)))&&r.push(s)}catch(e){}}return r}(s,[".js",".ts",".jsx",".tsx",".env",".json",".py",".go",".rb",".rs",".java",".sh",".yaml",".yml",".md"]),u=l.length,p=0;for(let e of l){p++;let t=(0,f.u)(e);if(!t)continue;let r=(0,f.p)(o().relative(s,e),t);i.push(...r)}try{d().rmSync(s,{recursive:!0,force:!0})}catch(e){}return t.status(200).json({success:!0,findings:i,scanned:p,totalFiles:u})}catch(r){try{d().rmSync(s,{recursive:!0,force:!0})}catch(e){}let e=r?.message||String(r);return t.status(500).json({success:!1,error:`Scan failed: ${e}`})}}let m=(0,a.l)(s,"default"),y=(0,a.l)(s,"config"),g=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/scan",pathname:"/api/scan",bundlePath:"",filename:""},userland:s})},7989:(e,t,r)=>{r.d(t,{p:()=>scanFile,u:()=>readFileSafe});var s=r(7147),n=r.n(s);function readFileSafe(e){try{return n().readFileSync(e,"utf8")}catch(t){return console.error(`Error reading file ${e}:`,t),null}}function scanFile(e){let t=[],r=/AKIA[0-9A-Z]{16}/g,s=/api_[0-9a-zA-Z]{16,}/g;return r.test(e)&&t.push({type:"AWS Access Key",snippet:e.match(r)?.[0]||""}),s.test(e)&&t.push({type:"Generic API Key",snippet:e.match(s)?.[0]||""}),t}}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222],()=>__webpack_exec__(7598));module.exports=r})();